package org.system;

import java.time.LocalDate;

import java.util.*;

public class Hospital {

	private static List<doctor> doctors = new ArrayList<>(); 
	
	private static List<Patient> patients = new ArrayList<>();
    
	private static List<Appointment> appointments = new ArrayList<>();
    
	private static Scanner scanner = new Scanner(System.in);
	
    public static void main(String[] args) {
        
    	initializeData();
        int choice;
        do {
            System.out.println("\n--- Welcome to the  Hospital ---");
            System.out.println("1. Register Patient");
            System.out.println("2. Book Appointment");
            System.out.println("3. Display Appointments");
            System.out.println("4. Update Patient");         
            System.out.println("5. Patient List");
            System.out.println("6. Update Appointment");
            System.out.println("7. Cancel Appointment");
            System.out.println("8. Exit");
            System.out.print("Enter your choice: ");
            choice = scanner.nextInt();

            switch (choice) {
                case 1 -> registerPatient();
                case 2 -> bookAppointment();
                case 3 -> displayAppointments();
                case 4 -> updatePatient();
                case 5-> displayPatients();
                case 6-> updateAppointment();
                case 7-> cancelAppointment();
                case 8 -> System.out.println("Thank you..");
                default -> System.out.println("Invalid choice.");
            }
            
        } while (choice != 8);
    }

    private static void cancelAppointment() {
		// TODO Auto-generated method stub
		
	}

	private static void updateAppointment() {
		// TODO Auto-generated method stub
		scanner.nextLine();
		System.out.println("Enter the Appointment Id:");
		String apid=scanner.nextLine();
		Appointment obj= findAppointmentById(apid);
		Patient pobj=obj.getPatient();
		System.out.println("Enter the name to update:");
		String u_name=scanner.nextLine();
		pobj.setName(u_name);
		System.out.println("Name updated succesfully");
	}

	private static Appointment findAppointmentById(String apid) {
		// TODO Auto-generated method 
		for(Appointment obj:appointments)
		{
			if(obj.getAid().equalsIgnoreCase(apid))
			{
				return obj;
			}
		}
		return null;
	}

	private static void displayPatients() {
		// TODO Auto-generated method stub
		for(Patient p: patients)
		{
			System.out.println(p);
		}
	}

	private static void updatePatient() {
		// TODO Auto-generated method stub
		scanner.nextLine();
    	System.out.println("Enter the Patient Id:");
    	String pid=scanner.nextLine();
    	Patient pobj=findPatientById(pid);
    	System.out.println("Do you want update patient name!! Please enter correct name");
    	String u_name=scanner.nextLine();
    	pobj.setName(u_name);
    
    	System.out.println("Patient Name updated Successfully");
    	return;
	}

	private static  void initializeData() {
        doctors.add(new doctor("Dr. singh", 45, "9999999999", "101", "Cardiology"));
        doctors.add(new doctor("Dr. rai", 50, "8888888888", "102", "Orthopedics"));
        doctors.add(new doctor("Dr. siya", 45, "45554556454", "103","Heart Specialist"));
 
    }

    private static void registerPatient() {
        scanner.nextLine(); 
        
        System.out.print("Enter Patient ID: ");
        String id = scanner.nextLine();
        
        for(Patient p: patients)
        {
        	if(p.getPatientId().equalsIgnoreCase(id))
        	{
        		System.out.println("Patient already registered");
        		return;
        	}
        }
        System.out.print("Enter Name: ");
        String name = scanner.nextLine();
        System.out.print("Enter Age: ");
        int age = scanner.nextInt();
        scanner.nextLine();
        System.out.print("Enter Contact: ");
        String contact = scanner.nextLine();
       
        System.out.print("Enter Type (General/Surgery): ");
        String type = scanner.nextLine();
        Patient obj=new Patient(name, age, contact, id, type);
        patients.add(obj);
        System.out.println("Patient Registered Successfully1!.");
    }

    
    private static void bookAppointment() {
        scanner.nextLine();
        System.out.print("Enter Patient ID: ");
        String pid = scanner.nextLine();
        
        
        for(Appointment a:appointments)
        {
        	Patient old=a.getPatient();
        	String oldpid=old.getPatientId();
        	if(oldpid.equals(pid))
        	{
        		System.out.println("Appointment already booked");
        	}
        }
       
        Patient patient = findPatientById(pid);
        
        if (patient == null) {
            System.out.println("Patient not found!!!!.");
            return;
        }
        
        System.out.print("Enter Specialization: ");
        String spec = scanner.nextLine();
        doctor doctor = findDoctorBySpecialization(spec);
       
        if (doctor == null) {
            System.out.println("No doctor available with that specialization.");
            return;
        }
        
        System.out.print("Enter Appointment Date (YYYY-MM-DD): ");
        String dateStr = scanner.nextLine();
        LocalDate date = LocalDate.parse(dateStr);
        System.out.println("Enter the appointment Id:");
        String appointmentId=scanner.nextLine();
        
        try {
            Appointment appointment = new Appointment(appointmentId, patient, doctor, date);
            appointments.add(appointment);
            System.out.println("Appointment Booked Successfully.");
        } catch (InvalidAppointmentException e) {
            System.out.println("Error:" + e.getMessage());
        }
    }

    private static void displayAppointments() {
        if (appointments.isEmpty()) {
            System.out.println("No appointments found.");
            return;
        }
        for (Appointment a : appointments) {
            
        	a.displaySummary();
        }
    }
    
    private static Patient findPatientById(String id) {
        for (Patient p : patients) {
            if (p.getPatientId().equals(id)) {
                return p;
            }
        }
        return null;
    }

    private static Doctor findDoctorBySpecialization(String spec) {
        for ( Doctor d : doctor) {
            if (d.getSpecialization().equalsIgnoreCase(spec)) {
                return d;
            }
        }
        return null;
    }                                                                                                                                                                                                                                     }
